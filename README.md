<h1>Malware Analysis Project</h1>


<h2>Description</h2>
The primary objective of this lab was to learn how to analyze malware by setting up a self-hosted, controlled environment using REMnux and FLARE VM on VirtualBox. This involved configuring their network to communicate with each other while remaining isolated from the internet, allowing for the safe detonation and study of malware samples.
<br />


<h2>Apps, Languages, & Utilities Used</h2>

- <b>PowerShell (Scripting - Windows)</b>
- <b>Terminal (Command Line Interface - varies by OS)</b>
- <b>VirtualBox (Virtualization Software)</b>

<h2>Environments Used </h2>

- <b>Ubuntu (Linux Distribution for REMnux)</b> 
- <b>Windows 10 Pro (Desktop Operating System for FlareVM)</b>
- <b>REMnux (Linux Distribution for Malware Analysis)</b> 
- <b>FlareVM (Malware Analysis Environment on Windows 10 Pro)</b> 


<h2>Testing Tools </h2>

- <b>To be continued...</b>

<h2>Steps Taken</h2>


### *1. Install Oracle VM VirtualBox Manager*
Navigate to https://www.virtualbox.org/, download the compatible version, and install it with dependencies.
### *2. Install Windows 10*
Visit https://www.microsoft.com/en-ca/software-download/windows10, get "Create Windows 10 installation media", click "Download tool now", choose "Create installation media (USB flash drive, DVD, or ISO file) for another PC", then select "ISO file" and save it. In Oracle VM VirtualBox Manager, click "Add" to create a new VM, name it, choose the previously downloaded Windows 10 ISO, select 4096MB RAM, 1 CPU, 50GB virtual disk, and finish. Start the VM, follow the installation prompts, select "Custom: Install Windows only (advanced)", and let Windows 10 install. Once installation is complete, use the "Search" option on the taskbar and type "Change proxy settings" and click it. Turn "Automatically detect settings" to "Off".
Then make sure to:
- Disable Windows Updates (at least until installation is finished)
- Disable Tamper Protection and any Anti-Malware solution (e.g., Windows Defender), preferably via Group Policy.
### *3. Install FlareVM*
* Open a `PowerShell` prompt as administrator
* Download the installation script [`installer.ps1`](https://raw.githubusercontent.com/mandiant/flare-vm/main/install.ps1) to your Desktop:
  * `(New-Object net.webclient).DownloadFile('https://raw.githubusercontent.com/mandiant/flare-vm/main/install.ps1',"$([Environment]::GetFolderPath("Desktop"))\install.ps1")`
* Unblock the installation script:
  * `Unblock-File .\install.ps1`
* Enable script execution:
  * `Set-ExecutionPolicy Unrestricted -Force`
    * If you receive an error saying the execution policy is overridden by a policy defined at a more specific scope, you may need to pass a scope in via `Set-ExecutionPolicy Unrestricted -Scope CurrentUser -Force`. To view execution policies for all scopes, execute `Get-ExecutionPolicy -List`
* Finally, execute the installer script as follow:
  * `.\install.ps1`
    * To pass your password as an argument: `.\install.ps1 -password <password>`
    * To use the CLI-only mode with minimal user interaction: `.\install.ps1 -password <password> -noWait -noGui`
    * To use the CLI-only mode with minimal user interaction and a custom config file: `.\install.ps1 -customConfig <config.xml> -password <password> -noWait -noGui`
* After installation it is recommended to switch to `host-only` networking mode and take a VM snapshot
### *4. Install REMnux*
Visit https://docs.remnux.org/install-distro/get-virtual-appliance, click "VirtualBox OVA" and then "Download". Once the download completes, head over to VirtualBox and hover over "File", and then click "Import Appliance". Navigate to the REMNUX .ova file and click "Next". Use the default Appliance settings and click "Finish".
### *4. Configure Host-only Adapter Network Mode*
Open VirtualBox and click "Tools", then click "Create". A new network has been created named "VirtualBox Host-Only Ethernet Adapter #2", click it and then change the "IPv4 Address:" to `10.0.0.1` and click "Apply". Then click the "DHCP Server" tab and enter `10.0.0.2` as the "Server Address:". Replace the "Lower Address Bound" with `10.0.0.3` and the "Upper Address Bound" to `10.0.0.254`, then click "Apply".
### *4. Configure REMnux*
* With REMnux open, navigate to "Activities" and select "Terminal".
* Navigate to inetsim directory:
  * `/etc/inetsim`
* Open the inetsim configuration file:
  * `sudo nano inetsim.conf`
* Use the keyboard down arrow to navigate to `#start_service dns` and remove the comment.
* Then find the `#service_bind_address` comment and remove it, replace `10.0.0.1` with `0.0.0.0`.
* Navigate down to the `#dns_default_ip` comment and remove it along with replacing `10.0.0.1` with `10.0.0.4`.
  * Using your keyboard, hit `CTRL + X` and then hit `Y`, and finally press "Enter" once more.
 ### *4. Configure FlareVM and REMnux Ethernet Adapter*
 Open VirtualBox and click on "FlareVM" , then click "Settings" and finally click "Network". Choose "Host-only Adapter" in the dropdown "Attached to:", then choose "VirtualBox Host-Only Ethernet Adapter #2" as the "Name:". Repeat the same steps for the REMnux virtual machine within VirtualBox. Once completed, the two machines should only be able to communicate with each other, but not the internet. Next, open the "FlareVM" machine and type in "Ethernet Settings" in the Windows search bar. Click "Change adapter options", right click "Ethernet" and choose "Properties". Double click "Internet Protocol Version 4 (TCP/IPv4)" and change the "Preferred DNS server address" to the REMnux server address which is `10.0.0.4`.
